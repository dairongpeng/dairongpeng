## 准备镜像
为了方便后续演示，简单使用go启动http服务。`examples/docker/images-builder-demo/main.go`

## 准备镜像描述文件
Docker v17.05 开始支持多阶段构建 (multistage builds), 缩减最终交付的镜像大小。

```Dockerfile
FROM golang:alpine as builder
ENV GO111MODULE=on GOPATH=/workspace/go

WORKDIR /workspace
COPY docker .

RUN go mod download -x
RUN CGO_ENABLED=0 go build -o main main.go

FROM alpine:latest as prod

WORKDIR /app
COPY --from=builder /workspace/main .

RUN chmod +x main
CMD ["./main"]
```

## 镜像构建
```shell
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] ls
Dockerfile go.mod     main.go
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker build -t image-builder-demo:v1.0.0 .
# ...more log...
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker images          
REPOSITORY           TAG       IMAGE ID       CREATED          SIZE
image-builder-demo   v1.0.0    19b3ddbe9e81   15 minutes ago   17.9MB
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker run -p 8081:8081 -d image-builder-demo:v1.0.0  ./main -port=8081
87d6fc128cd746221f806762aa3bd11bedb46dbdda72f32f8de8eef53c7ef953
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker ps                                                              
CONTAINER ID   IMAGE                       COMMAND               CREATED          STATUS          PORTS                    NAMES
87d6fc128cd7   image-builder-demo:v1.0.0   "./main -port=8081"   22 seconds ago   Up 21 seconds   0.0.0.0:8081->8081/tcp   condescending_wilson
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker logs 87d6fc128cd7             
2023/02/02 03:39:18 server run at :8081
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] curl 127.0.0.1:8081/helthz
OK
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker exec -it 87d6fc128cd7 sh
/app # ls
main
/app #
```

## 最终交付件
可以docker login登录自己的仓库，docker push交付镜像到仓库供其他人下载使用。
```shell
 ~/workspace/house/dairongpeng/examples/docker/image-builder-demo/ [master+*] docker images
REPOSITORY           TAG       IMAGE ID       CREATED          SIZE
image-builder-demo   v1.0.0    19b3ddbe9e81   40 minutes ago   17.9MB
```